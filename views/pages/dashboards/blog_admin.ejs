<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CleanTech - Recyclage Intelligent</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/public/css/m.css" />
<style>
:root {
--primary: #10b981;--primary-dark: #059669;
--primary-light: #d1fae5;
--secondary: #3b82f6;
--secondary-dark: #2563eb;
--accent: #f59e0b;
--dark: #1f2937;
--light: #f9fafb;
}
.dashboard-card {
background: white;
border-radius: 15px;
box-shadow: 0 4px 20px rgba(0,0,0,0.08);
transition: all 0.3s ease;
border: none;
overflow: hidden;
}
.dashboard-card:hover {
transform: translateY(-5px);
box-shadow: 0 8px 30px rgba(0,0,0,0.12);
}
.stat-card {
background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
color: white;
border-radius: 15px;
padding: 1.5rem;
}
.nav-pills-custom .nav-link {
border-radius: 10px;
margin: 0.2rem 0;
transition: all 0.3s ease;
}
.nav-pills-custom .nav-link.active {
background: var(--primary);
color: white;
}
</style>
</head>
<body>

<%- include('../../partials/navbar', { user, active: 'dashboard'}) %>
<br>
  <br>
  <main style="padding-top: 80px;">
<div class="container py-5">
<div class="row">
<div class="col-12">
<div class="d-flex justify-content-between align-items-center mb-5">
<div>
<h1 class="h2 fw-bold text-dark mb-2">Gestion du Blog</h1>
<p class="text-muted">Cr√©ez et g√©rez le contenu de votre blog</p>
</div>
<div class="bg-primary text-white rounded-pill px-3 py-1">
<small><i class="fas fa-newspaper me-1"></i>√âditeur
</small>
</div>
</div>
</div>
</div><!-- Formulaire de cr√©ation -->
<div class="row mb-5">
<div class="col-12">
<div class="dashboard-card p-4">
<h4 class="fw-bold mb-4">
üìù Nouvel article</h4>
<form action="/admin/blog/new" method="post">
<div class="row g-3">
<div class="col-12">
<label class="form-label fw-bold">Titre</label>
<input name="title" class="form-control form-control-lg" placeholder="Titre de l'article..." required>
</div>
<div class="col-12">
<label class="form-label fw-bold">Contenu</label
>
<textarea name="content" class="form-control" rows="8" placeholder="Contenu de l'article..." required></textarea
>
</div>
<div class="col-md-6">
<label class="form-label fw-bold">Statut</label>
<select name="status" class="form-select">
<option value="published">Publi√©</option>
<option value="draft">Brouillon</option>
</select>
</div>
<div class="col-12">
<button type="submit" class="btn btn-primary px-4">
<i class="fas fa-paper-plane me-2"></i>Publier l'article
</button>
</div></div>
</form>
</div>
</div>
</div>
<!-- Articles existants -->
<div class="row">
<div class="col-12">
<div class="dashboard-card p-4">
<h4 class="fw-bold mb-4">
üì∞ Articles existants</h4>
<% if (posts.length === 0) { %>
<div class="text-center py-5">
<i class="fas fa-newspaper fa-4x text-muted mb-3">
</i>
<h5 class="text-muted">Aucun article publi√©</h5>
<p class="text-muted">Commencez par cr√©er votre premier article !</p>
</div>
<% } else { %>
<div class="list-group list-group-flush">
<% posts.forEach(p => { %>
<div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-3">
<div class="flex-grow-1">
<h6 class="fw-bold mb-1"><%= p.title %></h6>
<p class="text-muted mb-2"><%= p.content.substring(0, 150) %>...</p>
<div class="d-flex gap-3">
<small class="text-muted">
<i class="fas fa-calendar me-1"></i>
<%= new Date(p.created_at * 1000).toLocaleDateString() %>
</small>
<span class="badge bg-<%= p.status === 'published' ? 'success' : 'warning' %>"><%= p.status === 'published' ? 'Publi√©': 'Brouillon' %>
</span>
</div>
</div>
<div class="d-flex gap-2 ms-3">
<button class="btn btn-outline-primary btn-sm" onclick="editPost(<%= p.id %>, '<%=p.title.replace(/'/g, "\\'") %>', '<%= p.content.replace(/'/g,"\\'") %>', '<%= p.status %>')">
<i class="fas fa-edit"></i>
</button>
<button class="btn btn-outline-danger btn-sm" onclick="deletePost(<%= p.id %>)">
<i class="fas fa-trash"></i>
</button>
</div>
</div>
<% }) %>
</div>
<% } %>
</div>
</div>
</div>
</div>
</main>

<footer class="bg-dark text-light py-5 mt-5">
<div class="container">
<div class="row">
<div class="col-lg-4 mb-4">
<h5 class="fw-bold mb-3">
<i class="fas fa-recycle me-2 text-primary"></i>CleanTech
</h5>
<p class="text-light">Recyclage r√©compens√© pour un avenir durable. Rejoignez notre communaut√© et faites la diff√©rence ensemble.</p>
<div class="social-links d-flex gap-3">
<a href="#" class="text-light"><i class="fab fa-facebook-f"></i></a>
<a href="#" class="text-light"><i class="fab fa-twitter"></i></a>
<a href="#" class="text-light"><i class="fab fa-instagram"></i></a>
<a href="#" class="text-light"><i class="fab fa-linkedin-in"></i></a>
</div>
</div>
<div class="col-lg-2 col-md-6 mb-4">
<h6 class="fw-bold mb-3">Navigation</h6>
<ul class="list-unstyled">
<li class="mb-2"><a href="/" class="text-light text-decoration-none">Accueil</a></li>
<li class="mb-2"><a href="/rewards" class="text-light text-decoration-none">R√©compenses</a></li><li class="mb-2"><a href="/blog" class="text-light text-decoration-none">Blog</a></li>
<li class="mb-2"><a href="/faq" class="text-light text-decoration-none">FAQ</a></li>
</ul>
</div>
<div class="col-lg-3 col-md-6 mb-4">
<h6 class="fw-bold mb-3">Liens utiles</h6>
<ul class="list-unstyled">
<li class="mb-2"><a href="/partners" class="text-light text-decoration-none">Partenaires</a></li>
<li class="mb-2"><a href="/challenges" class="text-light text-decoration-none">D√©fis</a></li>
<li class="mb-2"><a href="/leaderboard" class="text-light text-decoration-none">Classement</a></li>
<li class="mb-2"><a href="/contact" class="text-light text-decoration-none">Contact</a></li>
</ul>
</div>
<div class="col-lg-3 mb-4">
<h6 class="fw-bold mb-3">Contact</h6>
<ul class="list-unstyled">
<li class="mb-2"><i class="fas fa-map-marker-alt me-2 text-primary"></i>Cotonou, B√©nin</li>
<li class="mb-2"><i class="fas fa-phone me-2 text-primary"></i>+229 XX XX XX XX</li>
<li class="mb-2"><i class="fas fa-envelope me-2 text-primary"></i>contact@cleantech.bj</li>
</ul>
</div>
</div>
<hr class="my-4 bg-light">
<div class="row align-items-center"><div class="col-md-6">
<p class="mb-0 text-light">&copy; 2024 CleanTech. Tous droits r√©serv√©s.</p>
</div>
<div class="col-md-6 text-md-end">
<a href="#" class="text-light text-decoration-none me-3">Politique de confidentialit√©</a>
<a href="#" class="text-light text-decoration-none">Conditions d'utilisation</a>
</div>
</div>
</div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/public/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
(function(){
const p = new URLSearchParams(window.location.search);
const s = p.get('success');
const e = p.get('error');
if (s) {
Swal.fire({
icon: 'success',
title: 'Succ√®s',
text: s,
confirmButtonColor: '#10b981',
timer: 3000
});
}
if (e) {
Swal.fire({icon: 'error',
title: 'Erreur',
text: e,
confirmButtonColor: '#ef4444'
});
}
})();
</script>
<script>
function editPost(id, title, content, status) {
Swal.fire({
title: '√âditer l\'article',
html:
'<input id="swal-title" class="form-control mb-3" placeholder="Titre" value="'+title+'" required>' +'<textarea id="swal-content" class="form-control mb-3" rows="6" placeholder="Contenu" required>'+content+'</textarea>' +
'<select id="swal-status" class="form-select">' +
'<option '+(status==='published'?'selected':'')+' value="published">Publi√©</option>' +
'<option '+(status==='draft'?'selected':'')+' value="draft">Brouillon</option>' +
'</select>',
showCancelButton: true,
confirmButtonText: 'Enregistrer',
confirmButtonColor: '#10b981',
cancelButtonText: 'Annuler',
preConfirm: () => {
const title = document.getElementById('swal-title').value;
const content = document.getElementById('swal-content').va
lue;
const status = document.getElementById('swal-status').valu
e;
if (!title || !content) {Swal.showValidationMessage('Veuillez remplir tous les champs');
return false;
}
return { title, content, status };
}
}).then(res => {
if (!res.isConfirmed) return;
const payload = res.value;
fetch('/api/blog/'+id, {
method: 'PATCH',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(payload)
}).then(r => r.json()).then(() => {
window.location.href = '/admin/blog?success=' + encodeURIComponent('Article mis √† jour');
}).catch(() => {
window.location.href = '/admin/blog?error=' + encodeURICom
ponent('√âchec de la mise √† jour');
});
});
}
function deletePost(id) {
Swal.fire({
title: 'Supprimer cet article ?',
text: 'Cette action est irr√©versible.',
icon: 'warning',
showCancelButton: true,
confirmButtonText: 'Oui, supprimer',
confirmButtonColor: '#ef4444',
cancelButtonText: 'Annuler'
}).then(res => {
if (!res.isConfirmed) return;
fetch('/api/blog/'+id, { method: 'DELETE' })
.then(r => r.json())
.then(() => {
window.location.href = '/admin/blog?success=' + encodeUR
IComponent('Article supprim√©');
})
.catch(() => {
window.location.href = '/admin/blog?error=' + encodeURIC
omponent('√âchec de la suppression');
});
});
}
</script>
</body>
</html>